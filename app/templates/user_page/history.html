{% extends "layouts/user_layout/user.html" %}
{% block title %}Diagnosis History{% endblock %}

{% block content %}
<div class="container mt-4">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold">My Diagnosis History</h3>

        <a href="{{ url_for('user.diagnosis_input') }}" class="btn btn-success">
            <i class="bi bi-plus-lg me-1"></i> New Diagnosis
        </a>
    </div>

    <!-- Card -->
    <div class="card shadow-sm rounded-4">
        <div class="card-body p-3">

            <!-- Table -->
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">

                    <!-- Table Head -->
                    <thead class="table-light text-uppercase small">
                        <tr>
                            <!-- <th>#</th> -->
                            <th>Disease</th>
                            <th>Type</th>
                            <th>Severity</th>
                            <th>Confidence</th>
                            <th>Date</th>
                        </tr>
                    </thead>

                    <!-- Table Body -->
                    <tbody>

                        {% for h in histories %}
                        <tr>

                            <!-- ID
                            <td>{{ h.id }}</td> -->

                            <!-- Disease Name -->
                            <td class="fw-semibold">
                                {{ h.disease_name }}
                            </td>

                            <!-- Disease Type -->
                            <td>
                                <span class="badge bg-primary">
                                    {{ h.disease_type }}
                                </span>
                            </td>

                            <!-- Severity -->
                            <td>
                                {% if h.severity_level == 'High(ខ្ពស់)' %}
                                    <span class="badge bg-danger">High(ខ្ពស់)</span>
                                {% elif h.severity_level == 'Medium(មធ្យម)' %}
                                    <span class="badge bg-warning text-dark">Medium(មធ្យម)</span>
                                {% elif h.severity_level == 'Low(ទាប)' %}
                                    <span class="badge bg-success">Low(ទាប)</span>
                                {% else %}
                                    <span class="badge bg-secondary">Unknown</span>
                                {% endif %}
                            </td>

                            <!-- Confidence -->
                            <td>
                                {{ (h.confidence * 100)|round(2) }}%
                            </td>

                            <!-- Date -->
                            <td>
                                {{ h.created_at.strftime('%d-%m-%Y %H:%M') }}
                            </td>

                        </tr>

                        {% else %}

                        <!-- No Data -->
                        <tr>
                            <td colspan="6" class="text-center text-muted py-4">
                                <i class="bi bi-exclamation-circle me-1"></i>
                                No diagnosis history found.
                            </td>
                        </tr>

                        {% endfor %}

                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            {% if total_pages > 1 %}
            <nav class="mt-3">

                <ul class="pagination justify-content-end mb-0">

                    <!-- Previous -->
                    <li class="page-item {% if page <= 1 %}disabled{% endif %}">
                        <a class="page-link"
                           href="{{ url_for('user.diagnosis_history', page=page-1) }}">
                            <i class="bi bi-chevron-left"></i>
                        </a>
                    </li>

                    <!-- Pages -->
                    {% for p in range(1, total_pages + 1) %}

                        <li class="page-item {% if p == page %}active{% endif %}">
                            <a class="page-link"
                               href="{{ url_for('user.diagnosis_history', page=p) }}">
                                {{ p }}
                            </a>
                        </li>

                    {% endfor %}

                    <!-- Next -->
                    <li class="page-item {% if page >= total_pages %}disabled{% endif %}">
                        <a class="page-link"
                           href="{{ url_for('user.diagnosis_history', page=page+1) }}">
                            <i class="bi bi-chevron-right"></i>
                        </a>
                    </li>

                </ul>

            </nav>
            {% endif %}

        </div>
    </div>
</div>
{% endblock %}
