{% extends "layouts/base.html" %}
{% block title %} Sign Up {% endblock %}

{% block content %}
<div class="register-wrapper">
<div class="card shadow border-0 register-card">
<div class="row g-0">

    <!-- LEFT PANEL -->
    <div class="col-md-5 d-none d-md-flex flex-column justify-content-center align-items-center text-center left-panel p-4">
        <h3 class="fw-bold mb-3">Welcome</h3>
        <p class="small opacity-75">
            Welcome to System Diagnosis Rice Disease Symptom<br>
            សូមស្វាគមន៍មកកាន់ប្រព័ន្ធ វិនិច្ឆ័យជំងឺស្រូវ
        </p>
        <img src="{{ url_for('static', filename='images/logo_login.jpg') }}"
             style="max-width:70%; border-radius:15px;" class="mt-3">
    </div>

    <!-- RIGHT PANEL -->
    <div class="col-md-7 p-5">

        <h3 class="fw-bold mb-4 text-center">
            Create Account
        </h3>

        <form method="POST" action="{{ url_for('auth.register') }}" novalidate>
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

            <!-- Name -->
            <div class="mb-4">
                <label class="form-label">Full Name</label>
                <input type="text" name="full_name"
                       class="form-control"
                       placeholder="Enter your name"
                       value="{{ full_name or '' }}" required>
            </div>

            <!-- Email -->
            <div class="mb-4">
                <label class="form-label">Email</label>
                <input type="email" name="email"
                       class="form-control"
                       placeholder="Enter your email"
                       value="{{ email or '' }}" required>
            </div>

            <!-- Username -->
            <div class="mb-4">
                <label class="form-label">Username</label>
                <input type="text" name="username"
                       class="form-control"
                       placeholder="Choose username"
                       value="{{ username or '' }}" required>
            </div>

            <!-- Password -->
            <div class="mb-2 position-relative">
                <label class="form-label">Password</label>
                <input type="password" id="password" name="password"
                       class="form-control"
                       placeholder="Enter password"
                       required onkeyup="checkStrength()">
                <i class="bi bi-eye-slash eye-btn" id="togglePassword"></i>
            </div>

            <!-- Strength -->
            <div class="mb-3">
                <div class="progress">
                    <div id="strengthBar" class="progress-bar strength-bar"></div>
                </div>
                <small id="strengthText" class="text-muted"></small>
            </div>

            <!-- Confirm -->
            <div class="mb-4">
                <label class="form-label">Confirm Password</label>
                <input type="password" name="confirm_password"
                       class="form-control"
                       placeholder="Confirm password"
                       required>
            </div>

            <!-- Terms -->
            <div class="form-check mb-4">
                <input class="form-check-input" type="checkbox" required>
                <label class="form-check-label small">
                    I agree to Terms & Conditions
                </label>
            </div>

            <!-- Button -->
            <div class="d-grid mb-3">
                <button class="btn btn-primary rounded-pill fw-semibold">
                    SIGN UP
                </button>
            </div>

            <p class="text-center small">
                Already have account? 
                <a href="{{ url_for('auth.login') }}">Sign in</a>
            </p>
        </form>

    </div>
</div>
</div>
</div>

<!-- ================= JS ================= -->
<script>
const pwd = document.getElementById("password");
const toggle = document.getElementById("togglePassword");

toggle.addEventListener("click", function(){
    if(pwd.type === "password"){
        pwd.type = "text";
        toggle.className = "bi bi-eye eye-btn";
    }else{
        pwd.type = "password";
        toggle.className = "bi bi-eye-slash eye-btn";
    }
});

function checkStrength(){
    let val = pwd.value;
    let bar = document.getElementById("strengthBar");
    let text = document.getElementById("strengthText");
    let strength = 0;

    if(val.length >= 8) strength++;
    if(/[A-Z]/.test(val)) strength++;
    if(/[0-9]/.test(val)) strength++;
    if(/[^A-Za-z0-9]/.test(val)) strength++;

    if(strength === 0){
        bar.style.width="0%"; text.innerText="";
    }else if(strength === 1){
        bar.style.width="25%"; bar.className="progress-bar bg-danger strength-bar";
        text.innerText="Weak";
    }else if(strength === 2){
        bar.style.width="50%"; bar.className="progress-bar bg-warning strength-bar";
        text.innerText="Medium";
    }else if(strength === 3){
        bar.style.width="75%"; bar.className="progress-bar bg-info strength-bar";
        text.innerText="Good";
    }else{
        bar.style.width="100%"; bar.className="progress-bar bg-success strength-bar";
        text.innerText="Strong";
    }
}
</script>
{% endblock %}
